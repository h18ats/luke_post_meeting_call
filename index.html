<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Legal Engine Luke - Post Meeting Call</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: system-ui, Arial, sans-serif;
        margin: 2rem;
        line-height: 1.6;
        background: #f9fafb;
        color: #111827;
        text-align: center;
      }
      h1 { font-size: 2rem; margin-bottom: 1rem; }
      img.logo {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin: 1.5rem 0;
      }
      p { max-width: 600px; margin: 0 auto; }

      /* --- Webhook widget (bottom-left) --- */
      .webhook-fab {
        position: fixed;
        left: 16px;
        bottom: 16px;
        display: flex;
        gap: 10px;
        align-items: center;
        background: #111827;
        color: #f9fafb;
        border-radius: 999px;
        padding: 8px 12px;
        box-shadow: 0 10px 24px rgba(0,0,0,.18);
        z-index: 9999;
      }
      .webhook-btn {
        appearance: none;
        border: 0;
        background: #3b82f6;
        color: #0b1220;
        font-weight: 700;
        padding: 10px 14px;
        border-radius: 999px;
        cursor: pointer;
      }
      .webhook-btn[disabled] { opacity: .6; cursor: not-allowed; }
      .webhook-link {
        color: #a7bffb;
        text-decoration: none;
        font-size: 14px;
      }
      .webhook-link:focus, .webhook-link:hover { text-decoration: underline; }
      .webhook-log {
        position: fixed;
        left: 16px;
        bottom: 64px;
        max-width: 320px;
        background: #111827;
        color: #f9fafb;
        border: 1px solid rgba(255,255,255,.1);
        border-radius: 12px;
        padding: 10px 12px;
        box-shadow: 0 10px 24px rgba(0,0,0,.18);
        white-space: pre-wrap;
        font-size: 12px;
        line-height: 1.4;
        display: none; /* toggled by JS */
        z-index: 9999;
      }
      .webhook-log.show { display: block; }
      .webhook-log.success { border-color: #34d399; }
      .webhook-log.error { border-color: #f87171; }
    </style>
  </head>
  <body>
    <!-- Logo image -->
    <img class="logo" src="https://legalengine.co.uk/hs-fs/hubfs/e8ad0e08-aa6c-4d44-9053-cdcf7bbaec5b.png?width=852&height=339&name=e8ad0e08-aa6c-4d44-9053-cdcf7bbaec5b.png" alt="Legal Engine Logo" />

    <!-- ElevenLabs Agent Widget -->
    <elevenlabs-convai agent-id="agent_2501k3v11788e6w908yswfp1w66z"></elevenlabs-convai>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>

    <!-- Webhook widget -->
    <div
      id="le-webhook-widget"
      class="webhook-fab"
      data-url="https://leonard-dev.app.n8n.cloud/webhook/luke-pre-brief"  <!-- your n8n webhook -->
      data-method="POST"                                                   <!-- POST or GET -->
      data-token=""                                                        <!-- optional: sent as X-Webhook-Token -->
    >
      <button id="le-webhook-btn" class="webhook-btn">test n8n</button>
      <a id="le-webhook-link" class="webhook-link" target="_blank" rel="noopener">GET link</a>
    </div>
    <div id="le-webhook-log" class="webhook-log" aria-live="polite"></div>

    <script>
      (function () {
        const widget = document.getElementById('le-webhook-widget');
        const btn = document.getElementById('le-webhook-btn');
        const link = document.getElementById('le-webhook-link');
        const log = document.getElementById('le-webhook-log');

        const config = {
          url: widget?.dataset.url || '',
          method: (widget?.dataset.method || 'POST').toUpperCase(),
          token: widget?.dataset.token || '',
          getParams: { clicked: 'true', source: 'github-pages' },
          payload: { clicked: true, source: 'github-pages' }
        };

        function showLog(text, type) {
          log.textContent = text;
          log.classList.remove('success', 'error');
          if (type) log.classList.add(type);
          log.classList.add('show');
          clearTimeout(showLog._t);
          showLog._t = setTimeout(() => log.classList.remove('show'), 6000);
        }

        function buildGetUrl() {
          const u = new URL(config.url);
          Object.entries(config.getParams).forEach(([k, v]) => u.searchParams.set(k, v));
          u.searchParams.set('t', Date.now().toString());
          return u.toString();
        }

        function updateLink() {
          try { link.href = buildGetUrl(); }
          catch { link.removeAttribute('href'); }
        }

        async function sendWebhook() {
          const url = config.url;
          const method = config.method;
          if (!url) { showLog('No webhook URL configured.', 'error'); return; }

          btn.disabled = true;
          showLog('Sendingâ€¦');

          try {
            let res;
            if (method === 'GET') {
              res = await fetch(buildGetUrl(), { method: 'GET' });
            } else {
              const headers = { 'Content-Type': 'application/json' };
              if (config.token) headers['X-Webhook-Token'] = config.token;
              const body = JSON.stringify({ ...config.payload, timestamp: new Date().toISOString() });
              res = await fetch(url, { method: 'POST', headers, body });
            }

            const text = await res.text();
            showLog(`Status: ${res.status} ${res.statusText}\n\n${text}`, res.ok ? 'success' : 'error');
          } catch (err) {
            // Most common: CORS on the receiver blocks browser calls
            showLog(`Request failed (likely CORS on receiver). If this is an n8n Webhook, add CORS headers in your response (e.g., via an HTTP Response node) or call via a tiny proxy.\n\n${err}`, 'error');
          } finally {
            btn.disabled = false;
          }
        }

        // Init
        updateLink();
        btn.addEventListener('click', sendWebhook);
      })();
    </script>
  </body>
</html>
